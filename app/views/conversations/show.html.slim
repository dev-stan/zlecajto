.flex.flex-col data-controller="conversation" data-conversation-id=@conversation.id style="height: calc(var(--vh) * 100);"
  / Header
  .bg-white.border-b-2.border-gray-200
    .flex.items-center.justify-between.px-4.pt-6
      = link_to conversations_path, class: "text-2xl pb-2" do
        i.fas.fa-arrow-left aria-label="Back"
      .justify-center
        p.text-2xl.font-bold = @conversation.sender.display_name
      = render Users::AvatarComponent.new(user: @conversation.other_participant(current_user), size: 'sm', current_user: current_user)

    .flex.gap-3.items-center.pb-4.px-4
      .w-1/4.flex.items-center.justify-center
        - if @conversation.task.photos.attached?
          = image_tag @conversation.task.photos.first, class: 'rounded-lg'
        - else
          i.fas.fa-image.text-gray-400.text-6xl
      .w-3/4.flex.flex-col
        p.font-medium.truncate = @conversation.task.title
        .flex.justify-between
          p.text-sm class=(@conversation.task.status == 'open' ? 'text-red-600' : 'text-green-600')
            = @conversation.task.status == 'open' ? 'Anulowano wykonanie' : @conversation.task.status_before_type_cast.capitalize
          p.font-semibold = formatted_salary(@conversation.task)

  section.flex-1.flex.flex-col.overflow-hidden
    .flex-1.min-h-0.overflow-y-auto.px-3.py-6.mb-15 data-conversation-target="messages" id="messages"
      .flex.justify-center
        .bg-white.rounded-lg.mb-5.flex.flex-col.items-center.gap-2.text-center.border.border-blue-300.p-10
          = image_tag 'zlecajto_favicon.png', class: 'h-12 rounded-lg'
          p.font-medium Wybrano wykonawcÄ™ ğŸ”¥

      - @conversation.messages.each do |message|
        = render Messages::MessageComponent.new(message: message, current_user: current_user)

      - if @conversation.task.cancelled?
        .flex.justify-center
          .bg-red-200.rounded-lg.mb-5.flex.flex-col.items-center.gap-2.text-center.border.border-red-300.p-10
            = image_tag 'zlecajto_favicon.png', class: 'h-12 rounded-lg'
            p.font-medium Anulowano zlecenie âŒ
      - elsif @accepted_submission&.id != @participant_submission&.id
        .flex.justify-center
          .bg-red-200.rounded-lg.mb-5.flex.flex-col.items-center.gap-2.text-center.border.border-red-300.p-10
            = image_tag 'zlecajto_favicon.png', class: 'h-12 rounded-lg'
            p.font-medium Anulowano wykonanie âŒ

  - chat_disabled = @conversation.task.cancelled? || @conversation.task.submissions.where(status: :cancell_chosen).exists?
  .fixed.bottom-0.left-0.right-0.bg-white.px-3.py-4.z-50 style="padding-bottom: calc(1rem + env(safe-area-inset-bottom));"
    form.flex.flex-col.gap-3.w-full data-controller="conversation-image-upload" data-conversation-target="form" data-action="submit->conversation#send conversation:sent->conversation-image-upload#clear" class=(chat_disabled ? 'opacity-60' : nil)
      .hidden data-conversation-image-upload-target="previews"

      .flex.items-center.gap-3
        button.bg-primary.text-white.rounded-xl.hover:bg-blue-600.flex.items-center.justify-center.w-12.h-12 type="button" data-action="conversation-image-upload#chooseFiles" disabled=chat_disabled
          i.fa-solid.fa-image.text-white.text-xl
        input.flex-1.rounded-full.border-2.pl-3.border-blue-400.py-3.text-base.focus:outline-none.focus:border-blue-600.bg-white type="text" data-conversation-target="input" placeholder="WiadomoÅ›Ä‡..." disabled=chat_disabled
        button.bg-primary.text-white.rounded-xl.hover:bg-blue-600.flex.items-center.justify-center.w-12.h-12 type="submit" disabled=chat_disabled
          i.fa-solid.fa-arrow-up.text-white.text-xl

      input(type="file" accept="image/*" multiple hidden data-conversation-image-upload-target="fileInput" data-action="change->conversation-image-upload#fileChanged" disabled=chat_disabled)
      input(type="hidden" data-conversation-target="images" data-conversation-image-upload-target="imagesField")
